# DB 동기화 수정 보고서

## 문제 상황
웹 UI에서 문서 개수가 일관되지 않게 표시되는 문제:
- 자동 인덱싱: PDF 490개, TXT 3개
- 문서 라이브러리 총 문서: 810건
- 문서 라이브러리 전체: 496건

## 원인 분석

### 1. 다중 데이터 소스
- **metadata.db**: 810개 레코드 (중복 포함), 479개 고유 파일
- **everything_index.db**: 498개 항목 (중복 포함), 483개 고유 파일
- **file_index.json**: 483개 파일
- **실제 파일**: 493개 (483개 고유 파일명, 10개는 year_*/incoming/ 중복)

### 2. 중복 문제
- metadata.db: 같은 파일이 여러 번 인덱싱됨 (267개 중복)
- everything_index.db: 11개 파일에 중복 엔트리
- 파일 시스템: 10개 파일이 year_*와 incoming 폴더에 중복 존재

## 수정 내용

### 1. 데이터베이스 정리
- metadata.db: 810 → 479개 (중복 제거)
- everything_index.db: 498 → 483개 (중복 제거)
- file_index.json: 483개로 동기화

### 2. UI 코드 수정
- `components/sidebar_library.py`: 고유 문서 수만 표시하도록 수정
- `utils/pdf_utils.py`: Streamlit width 파라미터 업데이트
- `web_interface.py`: deprecated 파라미터 수정

### 3. 일관성 개선
- 모든 DB가 483개 고유 문서를 추적
- UI는 일관되게 고유 문서 수 표시
- 물리적 파일(493개)과 논리적 문서(483개) 구분

## 최종 상태

```
📁 실제 파일: 493개 (10개 중복 포함)
📊 고유 문서: 483개
  - PDF: 480개
  - TXT: 3개
📂 중복 위치: year_*/ 및 incoming/ 폴더

✅ 모든 DB 동기화 완료
  - metadata.db: 479개 (일부 메타데이터 누락)
  - everything_index.db: 483개
  - file_index.json: 483개
```

## 권장사항

1. **incoming 폴더 정리**: 중복 파일 제거 또는 별도 관리
2. **자동 중복 방지**: 인덱싱 시 파일명 기준 중복 체크
3. **정기 동기화**: 월 1회 DB 동기화 점검
4. **UI 일관성**: 항상 고유 문서 수 기준으로 표시

## 검증 완료
- ✅ 모든 DB가 483개 고유 문서로 동기화
- ✅ UI 일관된 카운트 표시
- ✅ 중복 문서 제거 완료